---
title: "Class09_Candy_Project"
author: "Ivan Henry Kish(A17262923)"
format: pdf
---

## Candy mini Project 

Today we will analyze different kinds of candy and the different aspects found between the different candies. First we must open the data set we want to work with and then we will answer a couple questions.


```{r}
candy_file <- "candy-data.csv"

candy = read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/candy-power-ranking/candy-data.csv", row.names=1)
head(candy)
```

>Q1. How many different candy types are in this data set?

```{r}
nrow(candy)
```

>Q2.How many fruity candy types are in the dataset?

```{r}
sum(candy$fruity)
```

>Q3. What is your favorite candy in the dataset `winpercent` value?

```{r}
candy["Kit Kat",]$winpercent
```

>Q4. What is the `winpercent` value for "Starburst"?(orignal question wanted to analyze Kit Kat but that was my favorite candy so I chose another.)

```{r}
candy["Starburst",]$winpercent
```

>Q5. What is the winpercent value for "Tootsie Roll Snack Bars"?

```{r}
candy["Tootsie Roll Snack Bars",]$winpercent
```

## Side-note: 

There is a useful `skim()` function in the skimr package that can help give you a quick overview of a given dataset. Let’s install this package and try it on our candy data.


```{r}
library("skimr")
skim(candy)
```

>Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

Winpercent is the only variable which does not lie on a 1-0 scale and goes much higher.

>Q7. What do you think a zero and one represent for the `candy$chocolate` column?

A 0 represents the candy is not chocolate and a 1 represents the candy is chocolate.

##  Exploratory analysis

We will now graphically analyze our data set with a histogram to answer the following questions.

>Q8. Plot a histogram of winpercent values using both base R an ggplot2.

```{r}
library(ggplot2)
ggplot(candy) + aes(winpercent) + geom_histogram(bins=10)
```
```{r}
hist(candy$winpercent)
```

>Q9. Is the distribution of winpercent values symmetrical?

The winpercent values are not symmetrical.

>Q10.Is the center of the distribution above or below 50%?

```{r}
ggplot(candy) + aes(winpercent) + geom_boxplot()
```


The center of distribution seems to be between 40%-50%.

>Q11.On average is chocolate candy higher or lower ranked than fruit candy?

Steps to solve this:
1. Find all chocolate candy in dataset.
2. Extract their winpercent values
3. Calculate mean of these values

4. Find all fruity candy
5. Find their winpercent values
6. Calculate their mean values.

7. Compare mean values.

```{r}
choc.candy <- candy[candy$chocolate==1,]
choc.win <- choc.candy$winpercent
mean(choc.win)
```

```{r}
fruit.candy <- candy[candy$fruity==1,]
fruit.win <- fruit.candy$winpercent
mean(fruit.win)
```

>Q12. Is this difference statistically significant?

```{r}
t.test(choc.win,
fruit.win)
```
The low p-value means we can reject the null hypothesis that these means are not signifcant and confidentlly state that the two means are different.

## Overall Candy Rankings 

Using `order()` and `head()` we can analyze the relative rankings of the candies.

>Q13. What are the five least liked candy types in this set?


```{r}
inds<- order(candy$winpercent)
head( candy[inds,], 5)
```

The 5 least liked candies are Nik L Nip, Boston Baked beans, chiclets, Super bubble, and jaw busters.

>Q14. What are the top 5 all time favorite candy types out of this set?

```{r}
inds<- order(candy$winpercent)
tail( candy[inds,], 5)
```

The top 5 are snickers, Kit kat, Twix, Reese's Miniatures, and Reese's Peanut Butter cup.

>Q15. Make a first barplot of candy ranking based on `winpercent` values.

```{r, fig.width=8, fig.height=16}
ggplot(candy) + 
  aes(winpercent, rownames(candy)) +
  geom_col()

ggsave("barplot1.png", height=10, width=6)
```

>Q16. This is quite ugly, use the `reorder()` function to get the bars sorted by `winpercent`?

```{r, fig.width=8, fig.height=16}
ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col()
```

## Time to add some color

We will now set up a color vector to signify candy type. First we make a vector of all black values(one for each candy.) We will then create colors for the chocolate and fruity candies.
 
```{r}
my_cols=rep("black", nrow(candy))
my_cols[as.logical(candy$chocolate)] = "chocolate"
my_cols[as.logical(candy$bar)] = "brown"
my_cols[as.logical(candy$fruity)] = "hotpink"
```
 
```{r, fig.width=8, fig.height=16}
ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 
```
>Q17. What is the worst ranked chocolate candy?

Sixlets are the worst ranked chocolate candy.

>Q18. What is the best ranked fruity candy?

Starburst are the best ranked fruity candy.


## Looking at pricepercent

It is reasonable to wonder, "what candy gives me the best bang for my buck?". We can find this by plotting winpercent against pricepercent. We can plot this and add labels to I.D. the different candies. We will use `geom_text_repel()` from the ggrepel package to give us nice and readable labels.

```{r}
library(ggrepel)

# How about a plot of win vs price
ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) + 
  geom_text_repel(col=my_cols, size=3.3, max.overlaps = 25)
```
>Q19. Which candy type is the highest ranked in terms of `winpercent` for the least money - i.e. offers the most bang for your buck?

Reese's miniatures seems to have the highest winpercent while still being below 50% pricepercent.

>Q20. What are the top 5 most expensive candy types in the dataset and of these which is the least popular?

```{r}
ord <- order(candy$pricepercent, decreasing = TRUE)
head(candy[ord,c(11,12)], n =5)
```

Of these 5 most expensive candies Nik L Nip is by far the least liked candy.

## Exploring the correlation structure

Now that we’ve explored the dataset a little, we’ll see how the variables interact with one another. We’ll use correlation and view the results with the **corrplot** package to plot a correlation matrix.

```{r}
library(corrplot)
cij <- cor(candy)
corrplot(cij)
```
>Q22.Examining this plot what two variables are anti-correlated (i.e. have minus values)?

If any two given variables have a hue in the red spectrum then they are anti-correlated.

>Q23.Similarly, what two variables are most positively correlated?

If any two given variable have a hue in the blue spectrum they are positively correlated.

## Principal Component Analysis

Let’s apply PCA using the `prcomp()` function to our candy dataset remembering to set the `scale=TRUE` argument.

```{r}
pca <- prcomp(candy, scale=T)
summary(pca)
```
Now we can plot our main PCA score plot of PC1 vs PC2

```{r}
plot(pca$x[,1:2])
```

Now let's add some color and change the plotting character.

```{r}
plot(pca$x[,1:2], col=my_cols, pch=16)

```

It's possible to make a nicer plot with ggplot2 given that we supply an input data.frame that has a seperate column for each of the aesthetics we want in our final plot.

```{r}
# Make a new data-frame with our PCA results and candy data
my_data <- cbind(candy, pca$x[,1:3])
```
```{r}
p <- ggplot(my_data) + 
        aes(x=PC1, y=PC2, 
            size=winpercent/100,  
            text=rownames(my_data),
            label=rownames(my_data)) +
        geom_point(col=my_cols)

p
```

We can again use ggrepel to label the plot with non overlapping candy names as well as adding a title and subtitle.

```{r}
library(ggrepel)

p + geom_text_repel(size=3.3, col=my_cols, max.overlaps = 7)  + 
  theme(legend.position = "none") +
  labs(title="Halloween Candy PCA Space",
       subtitle="Colored by type: chocolate bar (dark brown), chocolate other (light brown), fruity (hot pink), other (black)",
       caption="Data from 538")
```

If we want to see more points with more defined labels we can use plotly to create an interactive plot where we can use our mouse to see what each point is.

```{r}
#library(plotly)
#ggplotly(p)
```

Let's "loading plot for PC1

```{r}
ggplot(pca$rotation) +
  aes(PC1, reorder(rownames(pca$rotation),PC1)) +
  geom_col() 
```

>Q24. Complete the code to generate the loadings plot above. What original variables are picked up strongly by PC1 in the positive direction? Do these make sense to you? Where did you see this relationship highlighted previously?

Fruity and pluribus contribute strongly to PC1 in the positive direction which makes sense since these are similar trends that we saw in the correlation plot we made earlier.

## Summary

In this project we characterized the structure of the candy data set identifying key variables and then built visualizations to reveal relationships between candy popularity and pricing. Then using PCA we revealed that the primary axis of variation separates chocolate-based candies from fruity ones - the same pattern we observed in the correlation matrix, now visualized in a single, easy to read plot.

>Q25. Based on your exploratory analysis, correlation findings, and PCA results, what combination of characteristics appears to make a “winning” candy? How do these different analyses (visualization, correlation, PCA) support or complement each other in reaching this conclusion?

Looking at our varies visualization, correlation, and PCA charts we see that the most popular candies are those that are chocolates and bars with relatively reasonable pricing which is seein in our PCA plots and our PCA loadings.